<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PapoReto ‚Äî Entrar</title>
  <script src="config.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{--green:#00C16A;--green-dark:#009E56;--green-glow:rgba(0,193,106,0.2);--bg:#0A0F14;--surface:#111820;--surface2:#19232F;--border:#1E2A38;--text:#E8F0F8;--muted:#6B7F94;--subtle:#2E3D50;--red:#FF4757}
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Sora',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;display:grid;grid-template-columns:1fr 1fr}
    .left-panel{background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px;position:relative;overflow:hidden}
    .left-panel::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 20% 30%,rgba(0,193,106,0.12) 0%,transparent 60%),linear-gradient(rgba(0,193,106,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(0,193,106,0.03) 1px,transparent 1px);background-size:auto,50px 50px,50px 50px}
    .left-content{position:relative;z-index:1;text-align:center;max-width:360px}
    .left-logo{width:80px;height:80px;background:linear-gradient(135deg,var(--green),#009E56);border-radius:24px;display:flex;align-items:center;justify-content:center;font-size:38px;margin:0 auto 24px;box-shadow:0 0 60px var(--green-glow);animation:pulse 2.5s ease-in-out infinite}
    @keyframes pulse{0%,100%{box-shadow:0 0 40px var(--green-glow)}50%{box-shadow:0 0 80px rgba(0,193,106,0.35)}}
    .left-content h1{font-size:42px;font-weight:800;letter-spacing:-1.5px;margin-bottom:12px}
    .left-content h1 span{color:var(--green)}
    .left-content p{font-size:15px;color:var(--muted);line-height:1.7;margin-bottom:32px}
    .left-features{display:flex;flex-direction:column;gap:14px;text-align:left}
    .left-feature{display:flex;align-items:center;gap:12px;padding:14px 18px;background:rgba(0,193,106,0.04);border:1px solid rgba(0,193,106,0.1);border-radius:14px}
    .left-feature-icon{font-size:22px}
    .left-feature-text p:first-child{font-size:13px;font-weight:600}
    .left-feature-text p:last-child{font-size:12px;color:var(--muted)}
    .demo-badge{background:rgba(255,140,66,0.1);border:1px solid rgba(255,140,66,0.25);border-radius:10px;padding:10px 14px;font-size:12px;color:#FF8C42;margin-top:20px;line-height:1.6;text-align:left;display:none}
    .demo-badge strong{font-weight:700;display:block;margin-bottom:4px}
    .right-panel{display:flex;align-items:center;justify-content:center;padding:40px}
    .login-card{width:100%;max-width:420px;animation:slideIn .4s ease}
    @keyframes slideIn{from{opacity:0;transform:translateX(20px)}to{opacity:1;transform:translateX(0)}}
    .back-link{display:inline-flex;align-items:center;gap:8px;font-size:13px;color:var(--muted);text-decoration:none;margin-bottom:36px;transition:color .2s}
    .back-link:hover{color:var(--text)}
    .card-title{font-size:28px;font-weight:800;letter-spacing:-.8px;margin-bottom:6px}
    .card-sub{font-size:14px;color:var(--muted);margin-bottom:36px}
    .form-group{margin-bottom:20px}
    .form-group label{display:block;font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}
    .input-wrap{position:relative}
    .input-icon{position:absolute;left:14px;top:50%;transform:translateY(-50%);font-size:16px;color:var(--muted);pointer-events:none}
    .form-group input{width:100%;padding:13px 14px 13px 44px;background:var(--surface2);border:1.5px solid var(--border);border-radius:12px;color:var(--text);font-family:'Sora',sans-serif;font-size:14px;outline:none;transition:all .2s}
    .form-group input:focus{border-color:var(--green);box-shadow:0 0 0 3px rgba(0,193,106,0.1);background:var(--surface)}
    .form-group input::placeholder{color:var(--subtle)}
    .form-footer-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px}
    .checkbox-label{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--muted);cursor:pointer}
    .checkbox-label input{width:16px;height:16px;accent-color:var(--green);margin:0;padding:0}
    .forgot-link{font-size:13px;color:var(--green);text-decoration:none;cursor:pointer}
    .btn-primary{width:100%;padding:15px;background:var(--green);color:#000;font-weight:700;font-family:'Sora',sans-serif;font-size:15px;border:none;border-radius:12px;cursor:pointer;transition:all .2s;box-shadow:0 0 30px var(--green-glow);display:flex;align-items:center;justify-content:center;gap:8px}
    .btn-primary:hover{background:var(--green-dark);transform:translateY(-1px)}
    .btn-primary:disabled{opacity:.6;cursor:not-allowed;transform:none}
    .spinner{width:18px;height:18px;border:2px solid rgba(0,0,0,0.3);border-top-color:#000;border-radius:50%;animation:spin .6s linear infinite;display:none}
    @keyframes spin{to{transform:rotate(360deg)}}
    .divider{display:flex;align-items:center;gap:12px;margin:24px 0;color:var(--subtle);font-size:12px}
    .divider::before,.divider::after{content:'';flex:1;height:1px;background:var(--border)}
    .register-link{text-align:center;font-size:14px;color:var(--muted)}
    .register-link a{color:var(--green);text-decoration:none;font-weight:600}
    .error-msg{display:none;background:rgba(255,71,87,0.08);border:1px solid rgba(255,71,87,0.3);color:var(--red);padding:12px 16px;border-radius:10px;font-size:13px;margin-bottom:20px;animation:shake .4s ease}
    @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-6px)}75%{transform:translateX(6px)}}
    .success-msg{display:none;background:rgba(0,193,106,0.08);border:1px solid rgba(0,193,106,0.3);color:var(--green);padding:12px 16px;border-radius:10px;font-size:13px;margin-bottom:20px}
    @media(max-width:768px){body{grid-template-columns:1fr}.left-panel{display:none}.right-panel{padding:24px;align-items:flex-start;padding-top:60px}}
  </style>
</head>
<body>
  <div class="left-panel">
    <div class="left-content">
      <div class="left-logo">üí¨</div>
      <h1>Papo<span>Reto</span></h1>
      <p>A plataforma de mensagens para quem fala direto ao ponto.</p>
      <div class="left-features">
        <div class="left-feature"><span class="left-feature-icon">‚ö°</span><div class="left-feature-text"><p>Mensagens em tempo real</p><p>Entrega instant√¢nea via Supabase Realtime</p></div></div>
        <div class="left-feature"><span class="left-feature-icon">üîí</span><div class="left-feature-text"><p>Seguro e privado</p><p>Autentica√ß√£o com Supabase Auth + RLS</p></div></div>
        <div class="left-feature"><span class="left-feature-icon">üåç</span><div class="left-feature-text"><p>Suporte internacional</p><p>√Åfrica, Europa e Am√©rica</p></div></div>
      </div>
      <div class="demo-badge" id="demo-badge">
        <strong>üß™ Modo Demo Activo</strong>
        Configure o Supabase em <a href="configuracoes.html" style="color:#FF8C42">Configura√ß√µes ‚Üí Conex√£o</a><br>
        Conta demo: <code>demo@paporeto.com</code> / <code>123456</code>
      </div>
    </div>
  </div>

  <div class="right-panel">
    <div class="login-card">
      <a href="index.html" class="back-link">‚Üê Voltar ao in√≠cio</a>
      <h2 class="card-title">Bem-vindo de volta üëã</h2>
      <p class="card-sub">Entre na sua conta para continuar</p>
      <div class="error-msg" id="error-msg"></div>
      <div class="success-msg" id="success-msg"></div>
      <form id="login-form" onsubmit="handleLogin(event)" novalidate>
        <div class="form-group">
          <label>E-mail</label>
          <div class="input-wrap"><span class="input-icon">‚úâ</span><input type="email" id="email" placeholder="seu@email.com" autocomplete="email" required></div>
        </div>
        <div class="form-group">
          <label>Senha</label>
          <div class="input-wrap"><span class="input-icon">üîë</span><input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" required></div>
        </div>
        <div class="form-footer-row">
          <label class="checkbox-label"><input type="checkbox" id="remember-me" checked> Lembrar de mim</label>
          <a class="forgot-link" onclick="handleForgot(event)">Esqueci a senha</a>
        </div>
        <button type="submit" class="btn-primary" id="btn-login">
          <span class="spinner" id="spinner"></span>
          <span id="btn-text">Entrar na conta ‚Üí</span>
        </button>
      </form>
      <div class="divider">ou</div>
      <div class="register-link">N√£o tem conta? <a href="cadastro.html">Criar conta gr√°tis</a></div>
    </div>
  </div>
  <div id="toast-wrap"></div>

  <script>
    window.addEventListener('load', () => {
      const session = PR.Session.get();
      if (session?.id) { window.location.href = 'chat.html'; return; }
      if (PR.IS_DEMO) document.getElementById('demo-badge').style.display = 'block';
    });

    function showError(msg) { const e = document.getElementById('error-msg'); e.textContent = msg; e.style.display = 'block'; document.getElementById('success-msg').style.display = 'none'; }
    function showSuccess(msg) { const e = document.getElementById('success-msg'); e.textContent = msg; e.style.display = 'block'; document.getElementById('error-msg').style.display = 'none'; }
    function setLoading(on) {
      document.getElementById('spinner').style.display = on ? 'block' : 'none';
      document.getElementById('btn-text').textContent = on ? 'Entrando...' : 'Entrar na conta ‚Üí';
      document.getElementById('btn-login').disabled = on;
    }

    async function handleLogin(e) {
      e.preventDefault();
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      if (!email || !password) { showError('Preencha todos os campos.'); return; }
      if (!email.includes('@')) { showError('E-mail inv√°lido.'); return; }
      if (password.length < 6) { showError('Senha deve ter pelo menos 6 caracteres.'); return; }
      setLoading(true);
      try {
        if (PR.IS_DEMO) {
          await new Promise(r => setTimeout(r, 900));
          const stored = JSON.parse(localStorage.getItem('pr_users') || '[]');
          const user = stored.find(u => u.email === email && u.password === password);
          if (user) {
            PR.Session.set({ id: user.id, name: user.name, email: user.email, phone: user.phone || '', initials: PR_UTILS.getInitials(user.name) });
            showSuccess('Login realizado! Redirecionando...');
            setTimeout(() => window.location.href = 'chat.html', 700);
          } else if (email === PR.APP.demo_email && password === PR.APP.demo_password) {
            PR.Session.set({ id: 'demo_user', name: 'Utilizador Demo', email, phone: '+258840000000', initials: 'UD' });
            showSuccess('Modo demo activado! Redirecionando...');
            setTimeout(() => window.location.href = 'chat.html', 700);
          } else {
            setLoading(false);
            showError('E-mail ou senha incorretos. Tente ' + PR.APP.demo_email + ' / ' + PR.APP.demo_password);
          }
        } else {
          loadSupabaseSDK(async () => {
            try {
              const result = await PR.Auth.signIn(email, password);
              const { user, profile } = result;
              PR.Session.set({ id: user.id, name: profile?.name || email.split('@')[0], email, phone: profile?.phone || '', token: result.session?.access_token, refresh_token: result.session?.refresh_token, initials: PR_UTILS.getInitials(profile?.name || email), profile_url: profile?.profile_url || null });
              await PR.DB.updatePresence(user.id, true);
              showSuccess('Login realizado! Redirecionando...');
              setTimeout(() => window.location.href = 'chat.html', 700);
            } catch (err) {
              setLoading(false);
              showError(err.message?.includes('Invalid login') ? 'E-mail ou senha incorretos.' : (err.message || 'Erro ao entrar'));
            }
          });
        }
      } catch (err) { setLoading(false); showError(err.message || 'Erro inesperado.'); }
    }

    async function handleForgot(e) {
      e && e.preventDefault();
      const email = document.getElementById('email').value.trim();
      if (!email) { showError('Digite o seu e-mail primeiro.'); return; }
      if (PR.IS_DEMO) { showSuccess('No modo demo a recupera√ß√£o n√£o est√° dispon√≠vel.'); return; }
      try { await PR.Auth.resetPassword(email); showSuccess('E-mail de recupera√ß√£o enviado!'); } catch (err) { showError(err.message || 'Erro ao enviar e-mail.'); }
    }
  </script>
</body>
</html>
