<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PapoReto ‚Äî Grupos</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --green:#00C16A;--green-dark:#009E56;--green-glow:rgba(0,193,106,0.2);
      --bg:#0A0F14;--surface:#111820;--surface2:#19232F;--surface3:#1F2D3E;
      --border:#1E2A38;--text:#E8F0F8;--muted:#6B7F94;--subtle:#2E3D50;
      --red:#FF4757;--blue:#58A6FF;--orange:#FF8C42;--purple:#BC8CFF;
    }
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Sora',sans-serif;background:var(--bg);color:var(--text);min-height:100vh}

    /* ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ */
    .topbar{background:var(--surface);border-bottom:1px solid var(--border);padding:0 24px;height:58px;display:flex;align-items:center;gap:14px;position:sticky;top:0;z-index:20}
    .back-btn{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--muted);text-decoration:none;transition:color .2s;padding:8px 14px;border-radius:9px;background:transparent;border:none;cursor:pointer;font-family:'Sora',sans-serif}
    .back-btn:hover{color:var(--text);background:var(--surface2)}
    .page-title{font-size:17px;font-weight:700}
    .topbar-right{margin-left:auto;display:flex;gap:8px}
    .btn-sm{padding:9px 18px;border:none;border-radius:10px;font-family:'Sora',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s}
    .btn-sm.primary{background:var(--green);color:#000}
    .btn-sm.primary:hover{background:var(--green-dark)}

    /* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
    .page-body{max-width:900px;margin:0 auto;padding:28px 24px;display:grid;grid-template-columns:1fr 1fr;gap:24px}
    @media(max-width:700px){.page-body{grid-template-columns:1fr;padding:16px}}

    /* ‚îÄ‚îÄ CARD ‚îÄ‚îÄ */
    .card{background:var(--surface);border:1px solid var(--border);border-radius:20px;overflow:hidden}
    .card-header{padding:18px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
    .card-title{font-size:15px;font-weight:700}
    .card-sub{font-size:12px;color:var(--muted);margin-top:2px}

    /* ‚îÄ‚îÄ CREATE GROUP FORM ‚îÄ‚îÄ */
    .create-form{padding:20px}
    .fg{margin-bottom:18px}
    .fg label{display:block;font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}
    .fg input,.fg textarea{width:100%;padding:11px 14px;background:var(--surface2);border:1.5px solid var(--border);border-radius:11px;color:var(--text);font-family:'Sora',sans-serif;font-size:14px;outline:none;transition:all .2s;resize:none}
    .fg input:focus,.fg textarea:focus{border-color:var(--green);box-shadow:0 0 0 3px rgba(0,193,106,.1)}
    .fg textarea{min-height:80px;line-height:1.5}
    .fg input::placeholder,.fg textarea::placeholder{color:var(--subtle)}

    /* Icon uploader */
    .icon-picker{display:flex;gap:12px;align-items:center;margin-bottom:18px}
    .icon-preview{width:64px;height:64px;border-radius:50%;background:rgba(188,140,255,.15);border:2px dashed var(--purple);display:flex;align-items:center;justify-content:center;font-size:28px;cursor:pointer;transition:all .2s;flex-shrink:0;overflow:hidden}
    .icon-preview:hover{border-color:var(--green)}
    .icon-preview img{width:100%;height:100%;object-fit:cover}
    .icon-info p:first-child{font-size:13px;font-weight:600}
    .icon-info p:last-child{font-size:11px;color:var(--muted);margin-top:3px}

    /* Emoji icon selector */
    .emoji-icons-row{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px}
    .emoji-ico-btn{width:38px;height:38px;border:1.5px solid var(--border);border-radius:9px;background:var(--surface2);font-size:20px;cursor:pointer;transition:all .15s;display:flex;align-items:center;justify-content:center}
    .emoji-ico-btn:hover,.emoji-ico-btn.active{border-color:var(--green);background:rgba(0,193,106,.08)}

    /* Members list */
    .members-list{max-height:260px;overflow-y:auto;padding:0 20px 20px}
    .members-list::-webkit-scrollbar{width:3px}
    .members-list::-webkit-scrollbar-thumb{background:var(--border)}
    .member-item{display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid var(--border)}
    .member-item:last-child{border:none}
    .member-avatar{width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;flex-shrink:0}
    .member-info{flex:1}
    .member-name{font-size:13px;font-weight:600}
    .member-phone{font-size:11px;color:var(--muted);font-family:'Space Mono',monospace;margin-top:2px}
    .member-cb{width:20px;height:20px;accent-color:var(--green);cursor:pointer}

    /* Selected members chips */
    .selected-chips{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:16px;min-height:32px}
    .chip{display:flex;align-items:center;gap:6px;background:rgba(0,193,106,.1);border:1px solid rgba(0,193,106,.2);border-radius:20px;padding:5px 10px;font-size:12px;font-weight:600}
    .chip-remove{cursor:pointer;color:var(--muted);font-size:14px;transition:color .15s}
    .chip-remove:hover{color:var(--red)}

    /* ‚îÄ‚îÄ GROUPS LIST ‚îÄ‚îÄ */
    .groups-list{padding:8px}
    .group-card{display:flex;align-items:center;gap:14px;padding:14px;border-radius:14px;cursor:pointer;transition:all .2s;border:1px solid transparent;margin-bottom:6px}
    .group-card:hover{background:var(--surface2);border-color:var(--border)}
    .group-icon-big{width:52px;height:52px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px;flex-shrink:0;overflow:hidden}
    .group-icon-big img{width:100%;height:100%;object-fit:cover}
    .group-info{flex:1}
    .group-name{font-size:14px;font-weight:700}
    .group-meta{font-size:12px;color:var(--muted);margin-top:3px}
    .group-actions{display:flex;gap:4px}
    .ga-btn{width:32px;height:32px;border:none;border-radius:8px;background:transparent;color:var(--muted);font-size:15px;cursor:pointer;transition:all .15s;display:flex;align-items:center;justify-content:center}
    .ga-btn:hover{background:var(--surface3);color:var(--text)}
    .ga-btn.danger:hover{color:var(--red)}

    /* empty */
    .empty-state{text-align:center;padding:50px 20px;color:var(--muted)}
    .empty-icon{font-size:48px;margin-bottom:12px;opacity:.5}

    /* full-width section */
    .full-col{grid-column:1/-1}

    /* toast */
    .toast-wrap{position:fixed;top:16px;right:16px;z-index:200;display:flex;flex-direction:column;gap:8px;pointer-events:none}
    .toast{background:var(--surface);border:1px solid var(--border);border-left:4px solid var(--green);border-radius:12px;padding:12px 14px;min-width:260px;display:flex;align-items:flex-start;gap:10px;box-shadow:0 8px 30px rgba(0,0,0,.5);pointer-events:all;cursor:pointer;animation:toastIn .3s ease}
    @keyframes toastIn{from{opacity:0;transform:translateX(30px)}to{opacity:1;transform:translateX(0)}}
    .toast-icon{font-size:20px;flex-shrink:0}
    .toast-title{font-size:13px;font-weight:600}
    .toast-body{font-size:12px;color:var(--muted);margin-top:2px}

    /* modal overlay */
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);backdrop-filter:blur(6px);z-index:100;display:none;align-items:center;justify-content:center}
    .modal-overlay.visible{display:flex;animation:fadeIn .2s ease}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    .modal{background:var(--surface);border:1px solid var(--border);border-radius:20px;padding:28px;width:460px;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,.6);animation:slideUp .2s ease}
    @keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    .modal h3{font-size:17px;font-weight:700;margin-bottom:18px;display:flex;align-items:center;gap:8px}
    .modal-actions{display:flex;gap:10px;margin-top:20px;justify-content:flex-end}
    .btn-cancel{padding:10px 20px;background:transparent;border:1.5px solid var(--border);border-radius:10px;color:var(--text);font-family:'Sora',sans-serif;font-size:13px;cursor:pointer;transition:all .2s}
    .btn-cancel:hover{border-color:var(--muted)}
    .btn-confirm{padding:10px 20px;background:var(--green);border:none;border-radius:10px;color:#000;font-family:'Sora',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:all .2s}
    .btn-confirm:hover{background:var(--green-dark)}
  </style>
</head>
<body>

<!-- TOPBAR -->
<div class="topbar">
  <button class="back-btn" onclick="window.location.href='chat.html'">‚Üê Voltar</button>
  <div class="page-title">üë• Grupos</div>
  <div class="topbar-right">
    <button class="btn-sm primary" onclick="scrollToCreate()">+ Criar Novo Grupo</button>
  </div>
</div>

<!-- BODY -->
<div class="page-body">

  <!-- CREATE GROUP -->
  <div class="card" id="create-section">
    <div class="card-header">
      <div>
        <div class="card-title">‚ú¶ Criar Novo Grupo</div>
        <div class="card-sub">Configure e adicione membros</div>
      </div>
    </div>
    <div class="create-form">

      <!-- Icon picker -->
      <div class="icon-picker">
        <div class="icon-preview" id="group-icon-preview" onclick="document.getElementById('icon-file').click()">üë•</div>
        <div class="icon-info">
          <p>√çcone do grupo</p>
          <p>Clique na imagem ou escolha um emoji abaixo</p>
        </div>
      </div>
      <input type="file" id="icon-file" accept="image/*" style="display:none" onchange="handleGroupIcon(event)">

      <!-- Emoji icons -->
      <div class="emoji-icons-row" id="emoji-icons">
        <!-- rendered by JS -->
      </div>

      <div class="fg">
        <label>Nome do Grupo *</label>
        <input type="text" id="group-name" placeholder="Ex: Fam√≠lia, Trabalho, Amigos..." maxlength="50">
      </div>
      <div class="fg">
        <label>Descri√ß√£o</label>
        <textarea id="group-desc" placeholder="Do que se trata este grupo?"></textarea>
      </div>

      <!-- Selected chips -->
      <div class="fg">
        <label>Membros Selecionados</label>
        <div class="selected-chips" id="selected-chips">
          <span style="font-size:12px;color:var(--subtle);padding:4px 0">Selecione membros abaixo</span>
        </div>
      </div>

      <button class="btn-sm primary" style="width:100%;padding:13px;font-size:14px" onclick="createGroup()">
        ‚ú¶ Criar Grupo
      </button>
    </div>
  </div>

  <!-- MEMBERS TO ADD -->
  <div class="card">
    <div class="card-header">
      <div>
        <div class="card-title">üë§ Adicionar Membros</div>
        <div class="card-sub">Selecione quem vai participar</div>
      </div>
      <input type="text" placeholder="Buscar..." id="member-search"
        style="padding:8px 12px;background:var(--bg);border:1.5px solid var(--border);border-radius:9px;color:var(--text);font-family:'Sora',sans-serif;font-size:13px;outline:none;width:120px"
        oninput="renderMembersList()">
    </div>
    <div class="members-list" id="members-list">
      <!-- rendered by JS -->
    </div>
  </div>

  <!-- MY GROUPS -->
  <div class="card full-col">
    <div class="card-header">
      <div>
        <div class="card-title">üìã Meus Grupos</div>
        <div class="card-sub" id="groups-count">0 grupos</div>
      </div>
    </div>
    <div class="groups-list" id="groups-list">
      <!-- rendered by JS -->
    </div>
  </div>

</div>

<!-- MANAGE GROUP MODAL -->
<div class="modal-overlay" id="modal-manage">
  <div class="modal">
    <h3>‚öôÔ∏è Gerenciar Grupo</h3>
    <div class="fg">
      <label>Nome</label>
      <input type="text" id="edit-group-name" placeholder="Nome do grupo">
    </div>
    <div class="fg">
      <label>Descri√ß√£o</label>
      <textarea id="edit-group-desc" placeholder="Descri√ß√£o"></textarea>
    </div>
    <div id="modal-members-list" style="max-height:200px;overflow-y:auto;margin-top:8px"></div>
    <div class="modal-actions">
      <button class="btn-cancel" onclick="closeModal()">Cancelar</button>
      <button class="btn-confirm" onclick="saveGroupEdit()">Salvar</button>
    </div>
  </div>
</div>

<div class="toast-wrap" id="toast-wrap"></div>

<script>
  const SB_URL = localStorage.getItem('pr_url')||'https://SEU_PROJETO.supabase.co';
  const SB_KEY = localStorage.getItem('pr_key')||'SUA_ANON_KEY';
  const DEMO = SB_URL.includes('SEU_PROJETO');

  let session = null;
  let allUsers = [];
  let myGroups = [];
  let selectedMembers = new Set();
  let selectedGroupIcon = 'üë•';
  let editingGroup = null;

  const GROUP_EMOJIS = ['üë•','üè†','üíº','üéÆ','üìö','‚öΩ','üéµ','üçï','‚úàÔ∏è','üí™','üåç','üíª','üéâ','üî•','‚ù§Ô∏è','üéØ'];

  window.addEventListener('load', () => {
    const raw = localStorage.getItem('pr_session');
    if (!raw) { window.location.href='login.html'; return; }
    session = JSON.parse(raw);

    renderEmojiIcons();
    loadData();
  });

  function loadData() {
    // Load users
    const stored = JSON.parse(localStorage.getItem('pr_users')||'[]');
    const defaults = [
      {id:'u1',name:'Amina Chissano',phone:'+258841234567',initials:'AC',color:'#00C16A'},
      {id:'u2',name:'Carlos Mondlane',phone:'+258851234567',initials:'CM',color:'#58A6FF'},
      {id:'u3',name:'Fatima Nhavene',phone:'+27831234567',initials:'FN',color:'#BC8CFF'},
      {id:'u4',name:'Jo√£o Machava',phone:'+351912345678',initials:'JM',color:'#FF8C42'},
      {id:'u5',name:'Sofia Zita',phone:'+238971234567',initials:'SZ',color:'#FF4757'},
    ];
    allUsers = [...defaults, ...stored.filter(u=>u.id!==session?.id&&u.id!=='demo_user')];

    // Load groups from localStorage
    const storedGroups = JSON.parse(localStorage.getItem('pr_groups')||'[]');
    if (!storedGroups.length) {
      myGroups = [
        {id:'g1',name:'Fam√≠lia Maputo üè†',description:'Grupo familiar',icon:'üè†',members:['u1','u2','u3'],admin:session?.id||'me',created_at:new Date().toISOString()},
        {id:'g2',name:'Trabalho Dev üíª',description:'Time de desenvolvimento',icon:'üíª',members:['u1','u4','u5'],admin:session?.id||'me',created_at:new Date().toISOString()},
      ];
    } else {
      myGroups = storedGroups;
    }

    renderMembersList();
    renderGroupsList();
  }

  function renderEmojiIcons() {
    const row = document.getElementById('emoji-icons');
    row.innerHTML = GROUP_EMOJIS.map(e => `
      <button class="emoji-ico-btn ${e===selectedGroupIcon?'active':''}" onclick="selectEmojiIcon('${e}')">${e}</button>
    `).join('');
  }

  function selectEmojiIcon(emoji) {
    selectedGroupIcon = emoji;
    document.getElementById('group-icon-preview').innerHTML = emoji;
    renderEmojiIcons();
  }

  function handleGroupIcon(e) {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = ev => {
      document.getElementById('group-icon-preview').innerHTML = `<img src="${ev.target.result}" alt="">`;
      selectedGroupIcon = ev.target.result;
    };
    reader.readAsDataURL(file);
  }

  function renderMembersList() {
    const q = document.getElementById('member-search').value.toLowerCase();
    const list = document.getElementById('members-list');
    const filtered = allUsers.filter(u => u.name.toLowerCase().includes(q)||(u.phone||'').includes(q));

    if (!filtered.length) {
      list.innerHTML = '<div class="empty-state"><div class="empty-icon">üë§</div><p>Nenhum usu√°rio encontrado</p></div>';
      return;
    }

    list.innerHTML = filtered.map(u => `
      <div class="member-item">
        <div class="member-avatar" style="background:${u.color||'var(--green)'}20;color:${u.color||'var(--green)'}">${u.initials||'?'}</div>
        <div class="member-info">
          <div class="member-name">${esc(u.name)}</div>
          <div class="member-phone">${u.phone||''}</div>
        </div>
        <input type="checkbox" class="member-cb" value="${u.id}" ${selectedMembers.has(u.id)?'checked':''}
          onchange="toggleMember('${u.id}','${esc(u.name)}',this.checked)">
      </div>
    `).join('');
  }

  function toggleMember(id, name, checked) {
    if (checked) selectedMembers.add(id);
    else selectedMembers.delete(id);
    renderChips();
  }

  function renderChips() {
    const container = document.getElementById('selected-chips');
    if (!selectedMembers.size) {
      container.innerHTML = '<span style="font-size:12px;color:var(--subtle);padding:4px 0">Selecione membros abaixo</span>';
      return;
    }
    container.innerHTML = [...selectedMembers].map(id => {
      const u = allUsers.find(x=>x.id===id);
      return `<div class="chip">
        <span>${u?.initials||'?'}</span>
        <span>${esc(u?.name||id)}</span>
        <span class="chip-remove" onclick="removeMember('${id}')">‚úï</span>
      </div>`;
    }).join('');
  }

  function removeMember(id) {
    selectedMembers.delete(id);
    renderChips();
    renderMembersList();
  }

  function createGroup() {
    const name = document.getElementById('group-name').value.trim();
    const desc = document.getElementById('group-desc').value.trim();

    if (!name) { toast('‚ö†Ô∏è','Erro','Por favor insira o nome do grupo.'); return; }
    if (selectedMembers.size === 0) { toast('‚ö†Ô∏è','Erro','Adicione pelo menos um membro.'); return; }

    const group = {
      id: 'g_'+Date.now(),
      name, description: desc,
      icon: selectedGroupIcon,
      members: [...selectedMembers],
      admin: session.id,
      created_at: new Date().toISOString()
    };

    myGroups.push(group);
    saveGroups();
    renderGroupsList();
    toast('‚úÖ','Grupo criado!',`"${name}" foi criado com ${selectedMembers.size} membros.`);

    // Reset
    document.getElementById('group-name').value='';
    document.getElementById('group-desc').value='';
    selectedMembers.clear();
    selectedGroupIcon='üë•';
    document.getElementById('group-icon-preview').innerHTML='üë•';
    renderChips();
    renderMembersList();
    renderEmojiIcons();

    if (!DEMO) {
      // Supabase insert here
    }
  }

  function renderGroupsList() {
    const list = document.getElementById('groups-list');
    document.getElementById('groups-count').textContent = `${myGroups.length} grupos`;

    if (!myGroups.length) {
      list.innerHTML = '<div class="empty-state"><div class="empty-icon">üë•</div><p>Nenhum grupo ainda</p></div>';
      return;
    }

    list.innerHTML = myGroups.map(g => {
      const memberCount = g.members?.length||0;
      const memberNames = (g.members||[]).slice(0,3).map(id=>allUsers.find(u=>u.id===id)?.name?.split(' ')[0]||id).join(', ');
      const iconHtml = g.icon?.startsWith('data:')||g.icon?.startsWith('http')
        ? `<img src="${g.icon}" alt="" style="width:100%;height:100%;object-fit:cover;border-radius:50%">`
        : g.icon;

      return `<div class="group-card">
        <div class="group-icon-big" style="background:rgba(188,140,255,.15)">${iconHtml||'üë•'}</div>
        <div class="group-info">
          <div class="group-name">${esc(g.name)}</div>
          <div class="group-meta">üë• ${memberCount} membro${memberCount!==1?'s':''} ‚Ä¢ ${memberNames}</div>
          ${g.description?`<div class="group-meta" style="margin-top:2px;color:var(--subtle)">${esc(g.description.substring(0,50))}</div>`:''}
        </div>
        <div class="group-actions">
          <button class="ga-btn" onclick="openChat('${g.id}','${esc(g.name)}')" title="Abrir chat">üí¨</button>
          <button class="ga-btn" onclick="openManageModal('${g.id}')" title="Gerenciar">‚öôÔ∏è</button>
          <button class="ga-btn danger" onclick="deleteGroup('${g.id}')" title="Eliminar">üóëÔ∏è</button>
        </div>
      </div>`;
    }).join('');
  }

  function openChat(groupId, name) {
    window.location.href = `chat.html#group_${groupId}`;
  }

  function openManageModal(id) {
    editingGroup = myGroups.find(g=>g.id===id);
    if (!editingGroup) return;
    document.getElementById('edit-group-name').value = editingGroup.name;
    document.getElementById('edit-group-desc').value = editingGroup.description||'';

    // Modal members list with remove option
    const memberList = document.getElementById('modal-members-list');
    memberList.innerHTML = (editingGroup.members||[]).map(uid => {
      const u = allUsers.find(x=>x.id===uid);
      if (!u) return '';
      return `<div class="member-item">
        <div class="member-avatar" style="background:${u.color||'var(--green)'}20;color:${u.color||'var(--green)'};width:36px;height:36px">${u.initials||'?'}</div>
        <div class="member-info"><div class="member-name">${esc(u.name)}</div></div>
        <button style="border:none;background:transparent;color:var(--red);font-size:14px;cursor:pointer" onclick="removeFromGroup('${uid}')" title="Remover">‚úï</button>
      </div>`;
    }).join('');

    document.getElementById('modal-manage').classList.add('visible');
  }

  function removeFromGroup(uid) {
    if (!editingGroup) return;
    editingGroup.members = editingGroup.members.filter(m=>m!==uid);
    saveGroups();
    openManageModal(editingGroup.id);
    toast('‚úÖ','Membro removido','');
  }

  function saveGroupEdit() {
    if (!editingGroup) return;
    editingGroup.name = document.getElementById('edit-group-name').value.trim() || editingGroup.name;
    editingGroup.description = document.getElementById('edit-group-desc').value.trim();
    saveGroups();
    renderGroupsList();
    closeModal();
    toast('‚úÖ','Grupo atualizado!','');
  }

  function deleteGroup(id) {
    if (!confirm('Eliminar este grupo permanentemente?')) return;
    myGroups = myGroups.filter(g=>g.id!==id);
    saveGroups();
    renderGroupsList();
    toast('üóëÔ∏è','Grupo eliminado','');
  }

  function saveGroups() {
    localStorage.setItem('pr_groups', JSON.stringify(myGroups));
  }

  function scrollToCreate() {
    document.getElementById('create-section').scrollIntoView({behavior:'smooth'});
    document.getElementById('group-name').focus();
  }

  function closeModal() { document.getElementById('modal-manage').classList.remove('visible'); editingGroup=null; }

  document.getElementById('modal-manage').addEventListener('click', e=>{
    if (e.target===document.getElementById('modal-manage')) closeModal();
  });

  function toast(icon,title,body) {
    const wrap=document.getElementById('toast-wrap');
    const t=document.createElement('div');
    t.className='toast';
    t.innerHTML=`<div class="toast-icon">${icon}</div><div><div class="toast-title">${title}</div>${body?`<div class="toast-body">${body}</div>`:''}</div>`;
    t.onclick=()=>t.remove();
    wrap.appendChild(t);
    setTimeout(()=>{t.style.opacity='0';t.style.transform='translateX(30px)';t.style.transition='all .3s';setTimeout(()=>t.remove(),300);},4000);
  }

  function esc(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;')}
</script>
</body>
</html>
